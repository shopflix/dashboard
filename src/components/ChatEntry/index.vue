<template>
  <a href="/chat" target="_blank">
    <div class="chat-entry">
      <svg t="1620782635756" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
           p-id="13095" width="32" height="32">
        <path
          d="M520.97536 806.21056c4.72064 0 9.51808-0.2816 14.35136-0.86528 46.336-5.55008 85.67296-37.93408 100.1984-82.57024a6.85568 6.85568 0 0 0-3.6864-8.38656c-3.16416-1.46944-6.9888-0.19456-8.77056 2.80064-0.17408 0.29184-18.58048 30.01856-90.24512 39.69536a233.1904 233.1904 0 0 1-31.0528 2.19648c-50.21696-0.03584-72.59136-18.95936-72.79104-19.12832a6.8864 6.8864 0 0 0-8.97024-0.11776 6.92736 6.92736 0 0 0-1.43872 8.9088c21.85728 35.4304 61.0816 57.46688 102.40512 57.46688z"
          p-id="13096"></path>
        <path
          d="M906.3168 362.07616c-0.62464 0-1.2032 0.11264-1.81248 0.11264-41.98912-181.79072-202.43456-317.39904-394.79808-317.39904-197.6576 0-361.78944 143.09888-398.16704 332.41088-35.37408 6.36928-62.29504 37.4528-62.29504 75.05408v150.47168c0 42.17344 33.8176 76.37504 75.58144 76.37504 23.552 0 44.34432-11.11552 58.17856-28.20608 33.41824 88.38656 101.45792 159.67232 187.55584 197.25824 0.20992-0.44544 1.83808-3.61984 3.79904-6.13376 1.3568-1.75104 2.87232-3.2 4.17792-3.2 1.35168 0 2.59072 0.50176 3.65056 1.24416-19.93216-14.82752-91.91424-91.09504-107.49952-197.51936-6.84544-46.848 28.24192-92.8256 69.10976-100.43904 65.60256-12.2112 130.85184-26.12736 196.4544-38.10816 41.69728-7.6032 70.1952-30.48448 87.62368-68.57216 4.08576-8.90368 9.97888-26.9056 12.68736-52.864 0.7168-3.85536 3.88096-6.83008 7.936-6.83008 2.70336 0 5.00736 1.38752 6.52288 3.37408l1.81248-1.12128c25.856 37.53984 77.12768 120.65792 84.49536 208.29696 8.45312 100.1984 3.7376 168.832-72.96 239.04256-0.09216 0.08704-0.19968 0.19456-0.32256 0.2816a6.33344 6.33344 0 0 0-1.69472 4.3008c0 2.16064 1.15712 3.9936 2.82112 5.12 0.63488 0.26112 1.25952 0.60416 1.89952 0.86528 0.52224 0.11264 1.00352 0.29184 1.52064 0.29184 0.52224 0 0.97792-0.17408 1.43872-0.29184 1.09056-0.57344 2.1248-1.23392 3.19488-1.81248 77.55776-42.7264 137.0624-114.08384 164.55168-199.9104a77.57824 77.57824 0 0 0 48.80384 32.57856c-32.46592 147.68128-164.17792 240.10752-327.36256 254.13632-9.77408-24.24832-33.8432-41.48224-62.11584-41.48224-36.93056 0-66.8672 29.24032-66.8672 65.28 0 36.0448 29.93664 65.2544 66.8672 65.2544 29.76256 0 54.70208-19.12832 63.35488-45.39904 188.89216-15.36512 340.30592-127.63136 371.9168-302.07488 27.91936-11.66848 47.53408-39.07584 47.53408-71.05024V439.1424c0-42.55232-34.7392-77.06624-77.5936-77.06624z m-390.48192 586.43456c-1.67424 5.08416-6.87616 10.21952-14.72512 10.21952-8.64256 0-15.6672-6.30272-15.6672-14.0544 0-7.76704 7.02976-14.08 15.6672-14.08 7.48032 0 12.73856 4.73088 14.62784 9.4208l1.59232 3.95264-1.49504 4.54144zM509.70624 111.48288c166.85568 0 305.47456 121.63584 334.55104 282.08128-2.87232 3.86048-5.51936 7.89504-7.61856 12.24704-49.26464-133.44768-176.92672-228.7872-327.10656-228.7872-149.54496 0-276.74624 94.53056-326.47168 227.11296-2.46784-3.02592-5.376-5.61664-8.22272-8.23808 28.14976-161.56672 167.20384-284.416 334.86848-284.416z m284.92288 502.03648a1168.46592 1168.46592 0 0 0-2.2784-31.54944c-7.71584-91.78624-55.01952-177.38752-93.34784-233.03168 0 0-18.03776-27.65824-53.17632-24.3456-27.2896 2.57024-50.53952 21.30432-55.6032 48.64l-0.37376 2.00192-0.20992 2.02752c-1.9968 19.13856-6.14912 32.14848-8.2944 36.81792-10.63936 23.25504-25.67168 35.06688-50.27328 39.55712-35.20512 6.43072-70.68672 13.48608-105.00096 20.30592-30.05952 5.97504-61.14304 12.16-91.63776 17.83296-58.624 10.92096-103.46496 62.90432-110.76608 121.88672l-24.32-64.32256-56.1408 69.34528c-2.78528 3.44064-8.87808 9.216-18.3808 9.216-13.44 0-24.38144-11.29472-24.38144-25.17504V452.25472c0-12.19072 8.47872-22.56384 20.16256-24.66304l10.9312-1.96608 9.50784 8.76032c0.86528 0.79872 1.7664 1.56672 2.5856 2.41664l56.07936 68.74112 31.28832-83.42528c43.4944-115.97312 155.42784-193.8944 278.528-193.8944 123.79648 0 235.94496 78.49472 279.07584 195.31776l35.80416 96.99328-29.77792 92.98432z m138.0864-22.11328c0 10.37824-6.30784 19.73248-16.08192 23.808l-7.37792 3.08736-8.40192-1.72032a26.55232 26.55232 0 0 1-16.60416-11.01312l-35.42016-85.66784 33.91488-91.8272c0.18944-0.39424 0.8192-1.56672 2.59584-3.95264l7.97696-10.7264h11.19232c1.03424 0 2.05312-0.03072 3.07712-0.08704 13.97248 0.65024 25.13408 11.99104 25.13408 25.84064v152.25856z"
          p-id="13097"></path>
      </svg>
      <i v-if="un_read_num > 0" class="chat-entry__badge">{{ unread_num }}</i>
    </div>
  </a>
</template>

<script>
import * as API_IM from '@/api/im'

export default {
  name: 'ChatEntry',
  data() {
    return {
      un_read_num: 0,
      un_read_num_timer: null
    }
  },
  computed: {
    unread_num() {
      return this.un_read_num > 99 ? '99+' : this.un_read_num
    }
  },
  mounted() {
    this.getUnreadNum()
  },
  methods: {
    /**
     * Poll the number of unread messages
     * @returns {Promise<void>}
     */
    async getUnreadNum() {
      try {
        clearTimeout(this.un_read_num_timer)
        this.un_read_num = await API_IM.getUnreadNum()
      } finally {
        this.un_read_num_timer = setTimeout(this.getUnreadNum, 2000)
      }
    }
  }
}
</script>

<style lang="scss" scoped>
.chat-entry {
  position: relative;
  cursor: pointer;

  .chat-entry__badge {
    position: absolute;
    top: -10px;
    right: -18px;
    padding: 2px 5px;
    min-width: 20px;
    text-align: center;
    color: #ffffff;
    font-style: normal;
    font-size: 12px;
    background-color: #fa1313;
    border-radius: 90px;
    border: 1px solid #ffffff;
  }
}
</style>
